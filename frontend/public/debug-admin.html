<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Debug Admin - Leia Sabores</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 2rem;
      max-width: 800px;
      margin: 0 auto;
      background: #f5f5f5;
    }
    .card {
      background: white;
      padding: 1.5rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 { color: #333; }
    .error { color: #dc2626; }
    .success { color: #16a34a; }
    .info { color: #2563eb; }
    code {
      background: #f3f4f6;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
    }
    button {
      background: #2563eb;
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
      margin: 0.5rem 0.5rem 0.5rem 0;
    }
    button:hover { background: #1d4ed8; }
    .log {
      background: #1f2937;
      color: #10b981;
      padding: 1rem;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 0.875rem;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>üîç Debug do Painel Admin</h1>
    <p>Esta p√°gina verifica se os componentes do novo painel admin est√£o dispon√≠veis.</p>
  </div>

  <div class="card">
    <h2>1. Verificar Arquivos</h2>
    <button onclick="checkFiles()">Verificar Arquivos JS</button>
    <div id="files-result"></div>
  </div>

  <div class="card">
    <h2>2. Limpar Cache</h2>
    <button onclick="clearCache()">Limpar Todo o Cache</button>
    <div id="cache-result"></div>
  </div>

  <div class="card">
    <h2>3. Testar Rota</h2>
    <button onclick="testRoute()">Testar /admin/test</button>
    <div id="route-result"></div>
  </div>

  <div class="card">
    <h2>Logs</h2>
    <div id="logs" class="log"></div>
  </div>

  <script>
    function log(message, type = 'info') {
      const logs = document.getElementById('logs')
      const time = new Date().toLocaleTimeString()
      const color = type === 'error' ? '#ef4444' : type === 'success' ? '#10b981' : '#60a5fa'
      logs.innerHTML += `<div style="color: ${color}">[${time}] ${message}</div>`
      logs.scrollTop = logs.scrollHeight
    }

    async function checkFiles() {
      const result = document.getElementById('files-result')
      result.innerHTML = '<p>Verificando...</p>'
      log('Verificando arquivos...')

      const files = [
        '/assets/AdminLayout-*.js',
        '/assets/Dashboard-*.js',
        '/assets/index-*.js'
      ]

      try {
        // Tentar carregar o index principal
        const response = await fetch('/')
        const html = await response.text()
        
        if (html.includes('AdminLayout') || html.includes('Dashboard')) {
          result.innerHTML = '<p class="success">‚úÖ Arquivos encontrados no HTML</p>'
          log('‚úÖ Arquivos encontrados no HTML', 'success')
        } else {
          result.innerHTML = '<p class="error">‚ùå Arquivos n√£o encontrados no HTML</p>'
          log('‚ùå Arquivos n√£o encontrados no HTML', 'error')
        }

        // Verificar se h√° erros no console
        log('Verifique o console do navegador (F12) para mais detalhes', 'info')
      } catch (error) {
        result.innerHTML = `<p class="error">‚ùå Erro: ${error.message}</p>`
        log(`‚ùå Erro: ${error.message}`, 'error')
      }
    }

    async function clearCache() {
      const result = document.getElementById('cache-result')
      result.innerHTML = '<p>Limpando...</p>'
      log('Limpando cache...')

      try {
        // Desregistrar service workers
        if ('serviceWorker' in navigator) {
          const registrations = await navigator.serviceWorker.getRegistrations()
          for (const reg of registrations) {
            await reg.unregister()
            log(`‚úÖ Service Worker desregistrado: ${reg.scope}`, 'success')
          }
        }

        // Limpar caches
        if ('caches' in window) {
          const cacheNames = await caches.keys()
          for (const name of cacheNames) {
            await caches.delete(name)
            log(`‚úÖ Cache deletado: ${name}`, 'success')
          }
        }

        // Limpar storage
        localStorage.clear()
        sessionStorage.clear()
        log('‚úÖ Storage limpo', 'success')

        result.innerHTML = '<p class="success">‚úÖ Cache limpo com sucesso!</p>'
        log('‚úÖ Cache limpo completamente', 'success')
      } catch (error) {
        result.innerHTML = `<p class="error">‚ùå Erro: ${error.message}</p>`
        log(`‚ùå Erro: ${error.message}`, 'error')
      }
    }

    async function testRoute() {
      const result = document.getElementById('route-result')
      result.innerHTML = '<p>Testando...</p>'
      log('Testando rota /admin/test...')

      try {
        const response = await fetch('/admin/test')
        const status = response.status
        
        if (status === 200 || status === 404) {
          result.innerHTML = `<p class="info">‚ÑπÔ∏è Status: ${status} - A rota existe (404 √© normal se n√£o renderizar)</p>`
          log(`‚ÑπÔ∏è Status da rota: ${status}`, 'info')
        } else {
          result.innerHTML = `<p class="error">‚ùå Status: ${status}</p>`
          log(`‚ùå Status inesperado: ${status}`, 'error')
        }
      } catch (error) {
        result.innerHTML = `<p class="error">‚ùå Erro: ${error.message}</p>`
        log(`‚ùå Erro: ${error.message}`, 'error')
      }
    }

    // Auto-executar verifica√ß√£o ao carregar
    window.addEventListener('load', () => {
      log('P√°gina de debug carregada', 'success')
      checkFiles()
    })
  </script>
</body>
</html>

