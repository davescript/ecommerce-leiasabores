<!DOCTYPE html>
<html lang="pt-PT">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Painel Admin - Leia Sabores</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
  </style>
</head>
<body class="bg-gray-50">
  <div class="min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
      <div class="max-w-7xl mx-auto px-4 py-6">
        <h1 class="text-3xl font-bold text-gray-900">ğŸ° Painel Admin - Leia Sabores</h1>
        <p class="text-gray-600 mt-2">GestÃ£o de produtos e pedidos</p>
      </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 py-8">
      <!-- Status -->
      <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-6">
        <strong>âœ… Admin funcionando!</strong> Esta pÃ¡gina carrega diretamente sem redirects.
      </div>

      <!-- Token Section -->
      <div class="bg-white rounded-lg shadow p-6 mb-8">
        <h2 class="text-xl font-semibold mb-4">ğŸ”‘ ConfiguraÃ§Ã£o de Token</h2>
        <div class="flex gap-4">
          <input 
            type="password" 
            id="token-input"
            placeholder="JWT Token (admin)" 
            class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          />
          <button 
            onclick="saveToken()"
            class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
          >
            Salvar Token
          </button>
        </div>
        <p class="text-sm text-gray-500 mt-2">Token salvo: <span id="token-status">NÃ£o configurado</span></p>
      </div>

      <!-- Quick Stats -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="bg-white p-6 rounded-lg shadow">
          <h3 class="text-lg font-semibold text-gray-700">ğŸ“¦ Produtos</h3>
          <p class="text-3xl font-bold text-blue-600" id="products-count">-</p>
          <p class="text-sm text-gray-500">Total de produtos</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow">
          <h3 class="text-lg font-semibold text-gray-700">ğŸ›’ Pedidos</h3>
          <p class="text-3xl font-bold text-green-600">0</p>
          <p class="text-sm text-gray-500">Pedidos hoje</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow">
          <h3 class="text-lg font-semibold text-gray-700">ğŸ’° Vendas</h3>
          <p class="text-3xl font-bold text-purple-600">â‚¬0</p>
          <p class="text-sm text-gray-500">Vendas hoje</p>
        </div>
      </div>

      <!-- Products Section -->
      <div class="bg-white rounded-lg shadow">
        <div class="p-6 border-b border-gray-200">
          <div class="flex justify-between items-center">
            <h2 class="text-xl font-semibold">ğŸ“‹ Produtos</h2>
            <div class="flex gap-3">
              <button 
                onclick="loadProducts()"
                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
              >
                ğŸ”„ Atualizar
              </button>
              <button 
                onclick="createProduct()"
                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
              >
                â• Novo Produto
              </button>
            </div>
          </div>
        </div>
        
        <div class="p-6">
          <div id="loading" class="text-center py-8 hidden">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
            <p class="mt-2 text-gray-600">Carregando produtos...</p>
          </div>
          
          <div id="products-table" class="overflow-x-auto">
            <table class="min-w-full table-auto">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Nome</th>
                  <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">PreÃ§o</th>
                  <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Categoria</th>
                  <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Status</th>
                  <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">AÃ§Ãµes</th>
                </tr>
              </thead>
              <tbody id="products-body" class="divide-y divide-gray-200">
                <tr>
                  <td colspan="5" class="px-4 py-8 text-center text-gray-500">
                    Clique em "Atualizar" para carregar produtos
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    // Token management
    function saveToken() {
      const token = document.getElementById('token-input').value;
      if (token) {
        localStorage.setItem('admin_token', token);
        document.getElementById('token-status').textContent = 'Configurado âœ…';
        alert('Token salvo com sucesso!');
      }
    }

    // Check saved token on load
    window.onload = function() {
      const savedToken = localStorage.getItem('admin_token');
      if (savedToken) {
        document.getElementById('token-status').textContent = 'Configurado âœ…';
        document.getElementById('token-input').value = savedToken;
      }
      loadProducts(); // Auto-load products
    }

    // Load products
    async function loadProducts() {
      const loading = document.getElementById('loading');
      const tbody = document.getElementById('products-body');
      const countEl = document.getElementById('products-count');
      
      loading.classList.remove('hidden');
      
      try {
        const response = await fetch('https://api.leiasabores.pt/api/products');
        const data = await response.json();
        const products = data.data || [];
        
        countEl.textContent = products.length;
        
        if (products.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5" class="px-4 py-8 text-center text-gray-500">Nenhum produto encontrado</td></tr>';
        } else {
          tbody.innerHTML = products.map(product => `
            <tr class="hover:bg-gray-50">
              <td class="px-4 py-3 text-sm font-medium text-gray-900">${product.name || 'Sem nome'}</td>
              <td class="px-4 py-3 text-sm text-gray-900">â‚¬${(product.price || 0).toFixed(2)}</td>
              <td class="px-4 py-3 text-sm text-gray-600">${product.category || 'Sem categoria'}</td>
              <td class="px-4 py-3">
                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                  product.inStock ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                }">
                  ${product.inStock ? 'âœ… Ativo' : 'âŒ Inativo'}
                </span>
              </td>
              <td class="px-4 py-3">
                <div class="flex gap-2">
                  <button onclick="editProduct('${product.id}')" class="text-blue-600 hover:text-blue-800 text-sm font-medium">âœï¸ Editar</button>
                  <button onclick="deleteProduct('${product.id}')" class="text-red-600 hover:text-red-800 text-sm font-medium">ğŸ—‘ï¸ Excluir</button>
                </div>
              </td>
            </tr>
          `).join('');
        }
      } catch (error) {
        console.error('Erro ao carregar produtos:', error);
        tbody.innerHTML = '<tr><td colspan="5" class="px-4 py-8 text-center text-red-500">âŒ Erro ao carregar produtos</td></tr>';
        countEl.textContent = 'âŒ';
      }
      
      loading.classList.add('hidden');
    }

    function createProduct() {
      alert('ğŸš§ Funcionalidade em desenvolvimento!\nEm breve vocÃª poderÃ¡ criar produtos diretamente aqui.');
    }

    function editProduct(id) {
      alert(`âœï¸ Editar produto ID: ${id}\nğŸš§ Funcionalidade em desenvolvimento!`);
    }

    function deleteProduct(id) {
      if (confirm('â“ Tem certeza que deseja excluir este produto?')) {
        alert(`ğŸ—‘ï¸ Excluir produto ID: ${id}\nğŸš§ Funcionalidade em desenvolvimento!`);
      }
    }
  </script>
</body>
</html>
